(window.webpackJsonp=window.webpackJsonp||[]).push([[3,9,10,40,41],{505:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return d})),n.d(t,"a",(function(){return m}));var r=n(8),o=n(19),l=n.n(o);function c(e){return Object(r.a)({url:"coupon",method:"GET",params:e})}function d(e){return Object(r.a)({url:"coupon/user",method:"GET",params:e})}function m(data){return data=l.a.parse(data),Object(r.a)({url:"coupon",method:"POST",data:data})}},510:function(e,t,n){var content=n(660);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(12).default)("17f2989c",content,!0,{sourceMap:!1})},512:function(e,t,n){"use strict";n.d(t,"f",(function(){return c})),n.d(t,"a",(function(){return d})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return f})),n.d(t,"e",(function(){return h})),n.d(t,"b",(function(){return v}));var r=n(8),o=n(19),l=n.n(o);function c(e){return Object(r.a)({url:"shipping",method:"GET",params:e})}function d(data){return data=l.a.parse(data),Object(r.a)({url:"shipping",method:"POST",data:data})}function m(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/"+data.id,method:"POST",data:data})}function f(e){return Object(r.a)({url:"shipping/destroy/"+e,method:"POST"})}function h(e,data){return data=l.a.parse(data),Object(r.a)({url:"shipping/freight/"+e,method:"POST",data:data})}function v(data){return data=l.a.parse(data),Object(r.a)({url:"shipping/default/set",method:"POST",data:data})}},657:function(e,t,n){"use strict";n.r(t);var r=n(7),o=(n(36),n(18),n(512));t.default={name:"AddressList",props:{select:{type:Boolean,default:!1}},data:function(){return{src:"https://apis.map.qq.com/tools/locpicker?search=1&type=1&key=BHBBZ-25TCP-YRODO-VQXIO-RZKP6-AEBEC&referer=myapp",restaurants:[],buttonLoading:!1,loading:!1,dialogTitle:"添加收货地址",centerDialogVisible:!1,list:[],ruleForm:{location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],cellphone:[{required:!0,message:"请输入手机号",trigger:"blur"},{validator:function(e,t,n){if(""===t)n(new Error("请输入手机号"));else{/^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\d{8})$/.test(t)||n(new Error("手机号格式有误")),n()}},trigger:"blur"}],house:[{required:!0,message:"请输入门牌号",trigger:"blur"}]}}},watch:{},mounted:function(){this.getList(),window.addEventListener("message",this.handleSelect)},methods:{getList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(o.f)({sort:"-defaults"}).then((function(t){e.loading=!1,e.list=t.data,e.list.forEach((function(t){t.defaults?(t.on=!0,e.$emit("selectedAddress",t)):t.on=!1}))})).catch((function(){e.loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},switchAddress:function(e){this.select&&(this.list.forEach((function(e){e.on=!1})),e.on=!0,this.$emit("selectedAddress",e),this.$forceUpdate())},submitForm:function(){var e=this;this.$refs.ruleForm.validate((function(t){t&&(e.buttonLoading=!0,e.ruleForm.id?Object(o.d)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.centerDialogVisible=!1,e.$refs.ruleForm.resetFields(),e.getList(),e.$message({message:"修改成功",type:"success"})})).catch((function(){e.buttonLoading=!1})):(e.ruleForm.longitude||e.$message.error("请选择地址"),Object(o.a)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.centerDialogVisible=!1,e.$refs.ruleForm.resetFields(),e.getList(),e.$message({message:"添加成功",type:"success"})})).catch((function(){e.buttonLoading=!1}))))}))},defaultAddress:function(e){var t=this;this.$confirm("是否设为默认？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){t.buttonLoading=!0,Object(o.b)(e).then((function(e){t.buttonLoading=!1,t.getList(),t.$message({message:"设置成功",type:"success"})})).catch((function(){t.buttonLoading=!1}))})).catch((function(){}))},deleteAddress:function(e){var t=this;e.defaults?this.$message({message:"默认地址无法删除",type:"error"}):this.$confirm("确定要删除该地址吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((function(){t.buttonLoading=!0,Object(o.c)(e.id).then((function(e){t.buttonLoading=!1,t.getList(),t.$message({message:"删除成功",type:"success"})})).catch((function(){t.buttonLoading=!1}))})).catch((function(){}))},updateAddress:function(e){e.id?(this.ruleForm=e,this.dialogTitle="修改收货地址"):(this.ruleForm={location:"",address:"",name:"",house:"",cellphone:"",latitude:"",longitude:""},this.dialogTitle="添加收货地址"),this.centerDialogVisible=!0},handleSelect:function(e){var t=e.data;t&&"locationPicker"===t.module&&(this.ruleForm.location=t.poiname,this.ruleForm.address=t.poiaddress,this.ruleForm.longitude=t.latlng.lng,this.ruleForm.latitude=t.latlng.lat)}}}},658:function(e,t,n){"use strict";n.r(t);var r=n(657).default,o=(n(659),n(6)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"address-list"},[e._l(e.list,(function(t,r){return n("div",{key:r,staticClass:"address-item"},[n("div",{staticClass:"item-on",class:{on:t.on&&e.select},on:{click:function(n){return e.switchAddress(t)}}},[n("div",{staticClass:"address-info"},[n("div",{staticClass:"name"},[e._v("\n              "+e._s(t.name)+"\n              "),t.defaults?n("span",[e._v("默认")]):e._e()]),e._v(" "),n("div",{staticClass:"cellphone"},[e._v(e._s(t.cellphone))]),e._v(" "),n("div",{staticClass:"address-con"},[e._v(e._s(t.location?t.location+"(":"")+e._s(t.address)+" "+e._s(t.house?")"+t.house:""))]),e._v(" "),n("div",{staticClass:"address-action"},[e.select?e._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.defaultAddress(t)}}},[e._v("设为默认")]),e._v(" "),n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.updateAddress(t)}}},[e._v("修改")]),e._v(" "),e.select?e._e():n("el-link",{attrs:{type:"danger",underline:!1},on:{click:function(n){return e.deleteAddress(t)}}},[e._v("删除")])],1)])])])})),e._v(" "),n("div",{staticClass:"address-item",on:{click:e.updateAddress}},[e._m(0)])],2),e._v(" "),n("el-dialog",{attrs:{title:e.dialogTitle,visible:e.centerDialogVisible,"close-on-click-modal":!1,width:"600px;height:500px;overflow-y: auto;"},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[n("el-form",{ref:"ruleForm",staticClass:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"联系人",prop:"name"}},[n("el-input",{attrs:{clearable:"",maxlength:"20",placeholder:"请输入姓名"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"手机号",prop:"cellphone"}},[n("el-input",{attrs:{clearable:"",maxlength:"11",placeholder:"请输入手机号"},model:{value:e.ruleForm.cellphone,callback:function(t){e.$set(e.ruleForm,"cellphone",t)},expression:"ruleForm.cellphone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"地址",prop:"location"}},[e.ruleForm.longitude?n("div",[e._v(e._s(e.ruleForm.location)+"("+e._s(e.ruleForm.address)+")")]):n("div",[e._v("请在地图中选择地址")]),e._v(" "),e.ruleForm.longitude?n("iframe",{staticClass:"iframe",attrs:{height:"500",frameborder:"0",src:e.src+"&coord="+e.ruleForm.latitude+","+e.ruleForm.longitude}}):n("iframe",{staticClass:"iframe",attrs:{height:"500",frameborder:"0",src:e.src}})]),e._v(" "),n("el-form-item",{attrs:{label:"门牌号",prop:"house"}},[n("el-input",{attrs:{clearable:"",maxlength:"80",placeholder:"请输入门牌号"},model:{value:e.ruleForm.house,callback:function(t){e.$set(e.ruleForm,"house",t)},expression:"ruleForm.house"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.buttonLoading},on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{loading:e.buttonLoading,type:"danger"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1)}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"item"},[n("div",{staticClass:"add-desc"},[n("div",[n("i",{staticClass:"el-icon-circle-plus"})]),e._v(" "),n("div",[e._v("添加新地址")])])])}],!1,null,"5c109676",null);t.default=component.exports},659:function(e,t,n){"use strict";n(510)},660:function(e,t,n){var r=n(11)(!1);r.push([e.i,".address-list[data-v-5c109676]{display:flex;flex-wrap:wrap;align-content:center}.address-list .address-item[data-v-5c109676]{width:25%;padding-right:10px;padding-bottom:10px}.address-list .address-item .item[data-v-5c109676]{cursor:pointer;border:1px solid #e0e0e0;display:flex;justify-content:center;align-items:center;height:180px}.address-list .address-item .item .add-desc[data-v-5c109676]{text-align:center;color:#b0b0b0}.address-list .address-item .item .add-desc i[data-v-5c109676]{color:#e0e0e0;font-size:32px;margin-bottom:10px}.address-list .address-item .item:hover i[data-v-5c109676]{color:#b0b0b0}.address-list .address-item .item-on[data-v-5c109676]{cursor:pointer;border:1px solid #e0e0e0;display:flex;height:180px;padding:20px;position:relative}.address-list .address-item .item-on .address-info[data-v-5c109676]{width:100%;font-size:14px;color:#757575}.address-list .address-item .item-on .address-info .name[data-v-5c109676]{font-size:18px;margin-bottom:20px}.address-list .address-item .item-on .address-info .name span[data-v-5c109676]{color:#fa524c;float:right;font-size:12px}.address-list .address-item .item-on .address-info .address-action[data-v-5c109676]{position:absolute;bottom:20px;right:20px;display:none}.address-list .address-item .item-on:hover .address-action[data-v-5c109676]{display:block}.address-list .address-item .item-on.on[data-v-5c109676]{border:1px solid #fa524c}.iframe[data-v-5c109676]{border:1px solid #dcdfe6}",""]),e.exports=r},661:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var r=n(8);function o(e){return Object(r.a)({url:"integralDrawLog",method:"GET",params:e})}function l(e){return Object(r.a)({url:"integralDrawLogGood/"+e,method:"GET"})}},665:function(e,t,n){var content=n(690);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(12).default)("1a6f2ee4",content,!0,{sourceMap:!1})},679:function(e,t,n){"use strict";n.r(t);var r=n(17),o=n(7),l=(n(36),n(291),n(13),n(24),n(30),n(18),n(505));t.default={name:"CouponUse",props:{money:{type:Number,default:0}},data:function(){return{tableLoading:!1,checkboxAll:!1,loading:!0,buttonLoading:!1,list:[],total:0,couponMoney:0,couponIndex:null,visible:!1,listQuery:{limit:100,money:0,index:1,page:1,sort:"-created_at"}}},watch:{money:function(e){this.listQuery.money=e,this.getList()}},methods:{getList:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Promise.all([Object(l.c)(e.listQuery)]).then((function(t){var data=Object(r.a)(t,1)[0];data.data.forEach((function(t,n){switch(t.coupon.type){case 1:case 2:t.cost=t.coupon.cost/100,t.cost>e.couponMoney&&(e.couponMoney=t.cost,e.couponIndex=n);break;case 3:t.cost=e.listQuery.money*t.coupon.cost/1e4,t.cost>e.couponMoney&&(e.couponMoney=t.cost,e.couponIndex=n)}t.coupon.sill?t.sill="满"+t.coupon.sill/100+"可用":t.sill="无门槛"})),e.list=data.data,e.total=data.total,e.loading=!1,e.$emit("select",e.list[e.couponIndex])})).catch((function(t){e.loading=!1}));case 3:case"end":return t.stop()}}),t)})))()},select:function(e,t){this.couponIndex=t,this.visible=!1,this.$emit("select",e)}}}},689:function(e,t,n){"use strict";n(665)},690:function(e,t,n){var r=n(11)(!1);r.push([e.i,".coupon[data-v-27d1b77a]{display:flex;justify-content:flex-end}.coupon .tag[data-v-27d1b77a]{line-height:30px;cursor:pointer;border:1px dashed #fa524c;color:#fa524c;text-align:center;padding:0 10px}.ul .li[data-v-27d1b77a]{padding:10px;display:flex;align-items:flex-start}.ul .li .money[data-v-27d1b77a]{color:#fa524c;width:70px;text-align:center;border:1px dashed #fa524c;line-height:25px;padding:0 10px;margin:5px 10px 5px 0}.ul .li .explain[data-v-27d1b77a]{width:220px;padding-right:10px}.ul .li .explain .name[data-v-27d1b77a]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ul .li .button[data-v-27d1b77a]{margin-top:8px}",""]),e.exports=r},780:function(e,t,n){"use strict";n.r(t);var r=n(679).default,o=(n(689),n(6)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"coupon"},[n("el-popover",{attrs:{placement:"bottom",width:"400",trigger:"click"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticClass:"ul"},e._l(e.list,(function(t,r){return n("div",{key:r,staticClass:"li"},[n("div",{staticClass:"money"},[n("span",[e._v("￥")]),e._v(e._s(t.cost))]),e._v(" "),n("div",{staticClass:"explain"},[n("div",{staticClass:"name"},[e._v(e._s(t.coupon.explain))]),e._v(" "),t.coupon.end_time?n("div",{staticClass:"time"},[e._v("有效期至"+e._s(e._f("moment")(t.coupon.end_time,"YYYY.MM.DD")))]):n("div",{staticClass:"time"},[e._v("不限")])]),e._v(" "),n("el-button",{staticClass:"button",attrs:{type:"primary",size:"mini",loading:e.buttonLoading,disabled:e.couponIndex===r},on:{click:function(n){return e.select(t,r)}}},[e._v(e._s(e.couponIndex===r?"已选":"选择"))])],1)})),0),e._v(" "),n("div",{staticClass:"tag",attrs:{slot:"reference"},slot:"reference"},[e.list[e.couponIndex]?[e._v("\n            "+e._s(e.list[e.couponIndex].coupon.name)+"\n          ")]:[e._v("\n            选择优惠券\n          ")],e._v(" "),n("i",{staticClass:"el-icon-caret-bottom"})],2)])],1)])}),[],!1,null,"27d1b77a",null);t.default=component.exports},893:function(e,t,n){"use strict";n.r(t);var r=n(17),o=n(7),l=(n(36),n(198),n(25),n(75),n(13),n(24),n(30),n(294),n(18),n(50),n(658)),c=n(512),d=n(124),use=n(780),m=n(8),f=n(19),h=n.n(f);var v=n(661),_=n(189);t.default={components:{addressList:l.default,coupon:use.default},layout:"cart",middleware:"auth",head:function(){return{title:"确认订单-DSSHOP商城-跨终端商城解决方案"}},data:function(){return{loading:!0,buttonLoading:!1,total:0,ruleForm:{indentCommodity:[],address:{},remark:"",carriage:0,user_coupon_id:0,integral:0,integral_draw_log_id:0},couponMoney:0,integralPrice:0,integral:{available:0,deductible:0,parities:0},rules:{remark:[{validator:function(e,t,n){if(new RegExp("[`~!@#$^&*()=|{}':'\\[\\].<>《》/?~！@#￥……&*（）——|{}【】‘：”“'。？ ]").test(t))return n(new Error("不允许输入非法字符"));n()},trigger:"blur"}]},verify:{coupon:!1,seckill:!1},isSeckill:!1}},asyncData:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all([Object(_.a)(["coupon","integral","integralCommodity","seckill"])]);case 3:return n=t.sent,o=Object(r.a)(n,1),l=o[0],t.abrupt("return",{verify:l});case 9:t.prev=9,t.t0=t.catch(0),e.$errorHandler(t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})))()},mounted:function(){$nuxt.$store.commit("setCartTitle","确认订单"),$nuxt.$route.query.integral_draw_log_id?(this.ruleForm.integral_draw_log_id=$nuxt.$route.query.integral_draw_log_id,this.getIntegralDrawGoodList()):this.getList()},methods:{getList:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,data,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=null,e.ruleForm.indentCommodity=Object.values(e.store.get("DSSHOP-PC-OrderList")),data=[],r=!1,e.ruleForm.indentCommodity.forEach((function(t){e.total+=t.price*t.number,e.verify.seckill&&(r=t.good.seckill),t.good_sku&&(n=null,t.good_sku.product_sku.forEach((function(e){n?n+=e.value+";":n=e.value+";"})),t.specification=n.substr(0,n.length-1),data.push({ids:t.good_id,price:t.good_sku.price,skuIds:t.good_sku_id}))})),e.verify.seckill&&r&&(e.isSeckill=!0),e.verify.integralCommodity&&e.getDetailData(data);case 7:case"end":return t.stop()}}),t)})))()},getIntegralDrawGoodList:function(){var e=this,data=[];Object(v.b)(this.ruleForm.integral_draw_log_id).then((function(t){var n=null;e.ruleForm.indentCommodity=t,e.ruleForm.indentCommodity.forEach((function(t){e.total+=t.price*t.number,t.product_sku.forEach((function(e){n?n+=e.value+";":n=e.value+";"})),t.specification=n.substr(0,n.length-1),data.push({ids:t.good_id,price:t.price,skuIds:t.good_sku_id})}))})),this.getDetailData(data)},selectedAddress:function(e){var t=this;this.buttonLoading=!0,this.ruleForm.address=e,Object(c.e)(e.id,this.ruleForm.indentCommodity).then((function(e){t.ruleForm.carriage=e.carriage,t.buttonLoading=!1}))},submit:function(){var e=this;this.$refs.ruleForm.validate((function(t){return t?e.ruleForm.address?(e.buttonLoading=!0,void Object(d.c)(e.ruleForm).then((function(t){e.buttonLoading=!1,e.store.remove("DSSHOP-PC-CartList"),e.store.remove("DSSHOP-PC-OrderList"),Object(d.a)([]),$nuxt.$router.replace({path:"/money/pay",query:{id:t}})})).catch((function(){e.buttonLoading=!1}))):(e.$message({message:"请选择地址",type:"error"}),!1):(console.log("error submit!!"),!1)}))},go:function(){$nuxt.$router.go(-1)},calcTotal:function(e){e&&(this.couponMoney=e.cost,this.ruleForm.user_coupon_id=e.id)},getDetailData:function(e){var data,t=this;(data=e,data=h.a.parse(data),Object(m.a)({url:"integralCommodity",method:"POST",data:data})).then((function(e){t.integral.available=e.available,t.integral.deductible=e.deductible,t.integral.parities=e.parities,t.integral.available>=t.integral.deductible?(t.ruleForm.integral=t.integral.deductible,t.integralPrice=t.integral.deductible*t.integral.parities*100/100):(t.ruleForm.integral=t.integral.available,t.integralPrice=t.integral.available*t.integral.parities*100/100)}))},numberIntegral:function(e){this.integralPrice=e*this.integral.parities*100/100}}}}}]);