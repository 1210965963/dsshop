{"version":3,"file":"components/address-js-list.js","sources":["webpack:///./api/shipping.js","webpack:///./components/Address/js/list.js"],"sourcesContent":["/** +----------------------------------------------------------------------\r\n * | DSSHOP [ 轻量级易扩展低代码开源商城系统 ]\r\n * +----------------------------------------------------------------------\r\n * | Copyright (c) 2020~2023 https://www.dswjcms.com All rights reserved.\r\n * +----------------------------------------------------------------------\r\n * | Licensed 未经许可不能去掉DSSHOP相关版权\r\n * +----------------------------------------------------------------------\r\n * | Author: Purl <383354826@qq.com>\r\n * +----------------------------------------------------------------------\r\n */\r\nimport request from '@/plugins/request'\r\nimport Qs from 'qs'\r\nexport function getList(query) {\r\n  return request({\r\n    url: 'shipping',\r\n    method: 'GET',\r\n    params: query\r\n  })\r\n}\r\nexport function create(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'shipping',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\nexport function edit(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'shipping/' + data.id,\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\nexport function destroy(id) {\r\n  return request({\r\n    url: 'shipping/destroy/' + id,\r\n    method: 'POST'\r\n  })\r\n}\r\nexport function freight(id, data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'shipping/freight/'+id,\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\nexport function defaultSet(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'shipping/default/set',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n","import { create, getList, edit, destroy, defaultSet } from '@/api/shipping'\nexport default{\n  name: 'AddressList',\n  props: {\n    select: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    const validateCellphone = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error(this.$t('hint.error.import', { attribute: this.$t('find_password.cellphone') })));\n      } else {\n        const myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(16[0-9]{1})|(18[0-9]{1})|(17[0-9]{1}))+\\d{8})$/;\n        if (!myreg.test(value)) {\n          callback(new Error(this.$t('hint.error.wrong_format', { attribute: this.$t('find_password.cellphone') })));\n        }\n        callback();\n      }\n    };\n    return {\n      src: 'https://apis.map.qq.com/tools/locpicker?search=1&type=1&key='+process.env.IBS_KEY+'&referer=myapp', // https://lbs.qq.com\n      restaurants: [],\n      buttonLoading: false,\n      loading: false,\n      dialogTitle: this.$t('address.add'),\n      centerDialogVisible: false,\n      list: [],\n      ruleForm: {\n        location: '',\n        address: '',\n        name: '',\n        house: '',\n        cellphone: '',\n        latitude: '',\n        longitude: ''\n      },\n      rules: {\n        name: [\n          { required: true, message: this.$t('hint.error.import', { attribute: this.$t('address.name') }), trigger: 'blur' },\n        ],\n        cellphone: [\n          { required: true, message: this.$t('hint.error.import', { attribute: this.$t('find_password.cellphone') }), trigger: 'blur' },\n          { validator: validateCellphone, trigger: 'blur' }\n        ],\n        house: [\n          { required: true, message: this.$t('hint.error.import', { attribute: this.$t('address.house') }), trigger: 'blur' },\n        ],\n      }\n    };\n  },\n  watch: {},\n  mounted() {\n    this.getList()\n    window.addEventListener('message', this.handleSelect)\n  },\n  methods:{\n    async getList(){\n      this.loading = true;\n      await getList({\n        sort: '-defaults'\n      }).then(response => {\n        this.loading = false;\n        this.list = response.data\n        this.list.forEach(item=>{\n          if(item.defaults){\n            item.on = true\n            this.$emit('selectedAddress',item)\n          }else{\n            item.on = false\n          }\n        })\n      }).catch(() => {\n        this.loading = false\n      })\n    },\n    // 切换地址\n    switchAddress(res){\n      if(this.select){\n        this.list.forEach(item=>{\n          item.on = false\n        })\n        res.on = true\n        this.$emit('selectedAddress',res)\n        this.$forceUpdate()\n      }\n    },\n    submitForm(){\n      this.$refs['ruleForm'].validate((valid) => {\n        if (valid) {\n          this.buttonLoading = true;\n          if(this.ruleForm.id){\n            edit(this.ruleForm).then(response => {\n              this.buttonLoading = false;\n              this.centerDialogVisible = false\n              this.$refs['ruleForm'].resetFields();\n              this.getList()\n              this.$message({\n                message: this.$t('hint.succeed.win', { attribute: this.$t('common.amend') }),\n                type: 'success'\n              });\n            }).catch(() => {\n              this.buttonLoading = false\n            })\n          }else{\n            if(!this.ruleForm.longitude){\n              this.$message.error(this.$t('hint.error.selects', { attribute: this.$t('address.location') }));\n            }\n            create(this.ruleForm).then(response => {\n              this.buttonLoading = false\n              this.centerDialogVisible = false\n              this.$refs['ruleForm'].resetFields();\n              this.getList()\n              this.$message({\n                message: this.$t('hint.succeed.win', { attribute: this.$t('common.add') }),\n                type: 'success'\n              });\n            }).catch(() => {\n              this.buttonLoading = false\n            })\n          }\n        }\n      })\n    },\n    defaultAddress(item){\n      this.$confirm(this.$t('address.is_default'), this.$t('common.hint'), {\n        confirmButtonText: this.$t('common.confirm'),\n        cancelButtonText: this.$t('common.cancel'),\n        type: 'warning'\n      }).then(() => {\n        this.buttonLoading = true\n        defaultSet(item).then(response => {\n          this.buttonLoading = false;\n          this.getList()\n          this.$message({\n            message: this.$t('common.success'),\n            type: 'success'\n          });\n        }).catch(() => {\n          this.buttonLoading = false\n        })\n      }).catch(() => {\n      })\n    },\n    deleteAddress(item){\n      if(item.defaults){\n        this.$message({\n          message: this.$t('address.delete.confirm'),\n          type: 'error'\n        })\n        return\n      }\n      this.$confirm(this.$t('address.delete.title'), this.$t('common.hint'), {\n        confirmButtonText: this.$t('common.confirm'),\n        cancelButtonText: this.$t('common.cancel'),\n        type: 'warning'\n      }).then(() => {\n        this.buttonLoading = true\n        destroy(item.id).then(response => {\n          this.buttonLoading = false;\n          this.getList()\n          this.$message({\n            message: this.$t('hint.succeed.win', { attribute: this.$t('common.delete') }),\n            type: 'success'\n          });\n        }).catch(() => {\n          this.buttonLoading = false\n        })\n      }).catch(() => {\n      })\n    },\n    updateAddress(item){\n      if(item.id){\n        this.ruleForm = item\n        this.dialogTitle = this.$t('address.amend')\n      }else{\n        this.ruleForm = {\n          location: '',\n          address: '',\n          name: '',\n          house: '',\n          cellphone: '',\n          latitude: '',\n          longitude: ''\n        }\n        this.dialogTitle = this.$t('address.add')\n      }\n      this.centerDialogVisible = true\n    },\n    handleSelect(event) {\n      const loc = event.data;\n      if (loc && loc.module === 'locationPicker') {//防止其他应用也会向该页面post信息，需判断module是否为'locationPicker'\n        this.ruleForm.location = loc.poiname\n        this.ruleForm.address = loc.poiaddress\n        this.ruleForm.longitude = loc.latlng.lng\n        this.ruleForm.latitude = loc.latlng.lat\n      }\n    }\n  },\n}\n"],"mappings":";;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACxDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}