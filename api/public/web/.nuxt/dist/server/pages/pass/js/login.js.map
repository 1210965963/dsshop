{"version":3,"file":"pages/pass/js/login.js","sources":["webpack:///./pages/pass/js/login.js"],"sourcesContent":["import {login} from '@/api/login'\r\nimport {getList as bannerList} from '@/api/banner'\r\nimport {\r\n  mapMutations\r\n} from 'vuex';\r\nexport default {\r\n  layout: 'login',\r\n  head () {\r\n    return {\r\n      title: '登录' + '-' + process.env.APP_NAME\r\n    }\r\n  },\r\n  async asyncData (ctx) {\r\n    try {\r\n      let banner = {}\r\n      await bannerList({\r\n        limit: 1,\r\n        type: 2,\r\n        state: 0,\r\n        sort: '+sort'\r\n      }).then(response => {\r\n        if (response.total === 1) {\r\n          banner = response.data[0]\r\n          banner.url = banner.url ? banner.url.replace('?id=','/') : ''\r\n        }\r\n      })\r\n      return {\r\n        banner: banner\r\n      }\r\n    } catch(err) {\r\n      ctx.$errorHandler(err)\r\n    }\r\n  },\r\n  data() {\r\n    const validateCellphone = (rule, value, callback) => {\r\n      if (value === '') {\r\n        callback(new Error('请输入手机号'));\r\n      } else {\r\n        const myreg = /^1[3456789]\\d{9}$/;\r\n        if (!myreg.test(value)) {\r\n          callback(new Error('手机号格式有误'));\r\n        }\r\n        callback();\r\n      }\r\n    };\r\n    return {\r\n      method: 1,\r\n      ruleForm: {\r\n        cellphone: '',\r\n        password: '',\r\n        remember: false\r\n      },\r\n      loading: false,\r\n      rules: {\r\n        cellphone: [\r\n          { validator: validateCellphone, trigger: 'blur' }\r\n        ],\r\n        password: [\r\n          { required: true, message: '请输入密码', trigger: 'blur' },\r\n          { min: 5, message: '密码长度必须大于5位', trigger: 'blur' }\r\n        ]\r\n      },\r\n      banner: {}\r\n    }\r\n  },\r\n  beforeDestroy() {\r\n    clearInterval(this.codeTimer)\r\n  },\r\n  methods: {\r\n    ...mapMutations(['login']),\r\n    setMethod(index){\r\n      this.method = index\r\n    },\r\n    toLogin(){\r\n      this.$refs['ruleForm'].validate((valid) => {\r\n        if (valid) {\r\n          this.loading = true;\r\n          login(this.ruleForm).then(response => {\r\n            response.remember = this.ruleForm.remember\r\n            this.login(response);\r\n            this.$message({\r\n              message: '登录成功',\r\n              type: 'success'\r\n            });\r\n            this.loading = false;\r\n            const route = this.store.get('route');\r\n            if(route){\r\n              this.store.remove('route');\r\n              this.$router.replace({ path: route.path, query: route.query })\r\n            }else{\r\n              $nuxt.$router.replace('/user/portal')\r\n            }\r\n          }).catch(() => {\r\n            this.loading = false\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n"],"mappings":";;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AANA;AASA;AAjBA;AAmBA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9BA;AA/DA;;;;A","sourceRoot":""}