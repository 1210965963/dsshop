{"version":3,"file":"pages/money/js/pay.js","sources":["webpack:///./api/pay.js","webpack:///./pages/money/js/pay.js"],"sourcesContent":["/** +----------------------------------------------------------------------\r\n * | DSSHOP [ 轻量级易扩展低代码开源商城系统 ]\r\n * +----------------------------------------------------------------------\r\n * | Copyright (c) 2020~2023 https://www.dswjcms.com All rights reserved.\r\n * +----------------------------------------------------------------------\r\n * | Licensed 未经许可不能去掉DSSHOP相关版权\r\n * +----------------------------------------------------------------------\r\n * | Author: Purl <383354826@qq.com>\r\n * +----------------------------------------------------------------------\r\n */\r\nimport request from '@/plugins/request'\r\nimport Qs from 'qs'\r\nexport function unifiedPayment(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'unifiedPayment',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\nexport function balancePay(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'balancePay',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n","import { pay } from '@/api/goodIndent'\nimport { unifiedPayment, balancePay } from '@/api/pay'\nimport VueCountdown from '@chenfengyuan/vue-countdown';\nimport VueQrcode from '@chenfengyuan/vue-qrcode';\nexport default {\n  components: { VueCountdown, VueQrcode },\n  layout: 'cart',\n  middleware: 'auth',\n  head () {\n    return {\n      title: this.$t('money.title') + '-' + process.env.APP_NAME,\n    }\n  },\n  data() {\n    return {\n      loading: true,\n      detail: false,\n      centerDialogVisible: false,\n      buttonLoading: false,\n      qrcode: '',\n      timer: null,\n      list: {}\n    }\n  },\n  mounted() {\n    $nuxt.$store.commit('setCartTitle', this.$t('money.title'));\n    this.getList()\n  },\n  methods: {\n    getList(){\n      pay($nuxt.$route.query.id).then(response => {\n        if(response.state !== 1) {  // 订单发生改变时，直接跳转到结果页\n          if (response.state === 4) {\n            // $nuxt.$router.replace('/user/indent/list')\n            $nuxt.$router.replace({path: '/user/indent/detail', query:{id:$nuxt.$route.query.id}})\n          } else {\n            $nuxt.$router.replace('/money/success')\n          }\n\n        }\n        this.loading = false;\n        this.list = response\n      }).catch(error=>{\n        this.$message({\n          message: this.$t('common.arguments'),\n          type: 'error'\n        });\n\n      })\n    },\n    // 显示详情\n    showDetail(){\n      this.detail = !this.detail\n    },\n    // 支付\n    payment(type){\n      this.buttonLoading = true\n      if(type === 1){ // 余额支付\n        balancePay({id:$nuxt.$route.query.id}).then(response => {\n          this.buttonLoading = false\n          $nuxt.$router.replace('/money/success')\n        })\n      }else{\n        unifiedPayment({\n          id: $nuxt.$route.query.id,\n          platform: type,\n          trade_type: 'NATIVE',\n          type: 'goodsIndent'\n        }).then(response => {\n          this.centerDialogVisible = true\n          this.qrcode = response.code_url\n          this.buttonLoading = false\n          if (this.timer) {\n            clearInterval(this.timer)\n            this.timer = setInterval(() => {\n              this.getList()\n            }, 5000);\n          } else {\n            this.timer = setInterval(() => {\n              this.getList()\n            }, 5000);\n          }\n        }).catch(error=>{\n          this.$message({\n            message: this.$t('money.error'),\n            type: 'error'\n          });\n          this.buttonLoading = false\n        })\n      }\n    }\n  },\n  destroyed(){\n    clearInterval(this.timer)\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}