{"version":3,"file":"pages/money/js/pay.js","sources":["webpack:///./api/pay.js","webpack:///./pages/money/js/pay.js"],"sourcesContent":["import request from '@/plugins/request'\r\nimport Qs from 'qs'\r\nexport function unifiedPayment(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'unifiedPayment',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\nexport function balancePay(data) {\r\n  data = Qs.parse(data)\r\n  return request({\r\n    url: 'balancePay',\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n","import { pay } from '@/api/goodIndent'\r\nimport { unifiedPayment, balancePay } from '@/api/pay'\r\nimport VueCountdown from '@chenfengyuan/vue-countdown';\r\nimport VueQrcode from '@chenfengyuan/vue-qrcode';\r\nexport default {\r\n  components: { VueCountdown, VueQrcode },\r\n  layout: 'cart',\r\n  middleware: 'auth',\r\n  head () {\r\n    return {\r\n      title: '支付订单' + '-' + process.env.APP_NAME,\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      loading: true,\r\n      detail: false,\r\n      centerDialogVisible: false,\r\n      buttonLoading: false,\r\n      qrcode: '',\r\n      timer: null,\r\n      list: {}\r\n    }\r\n  },\r\n  mounted() {\r\n    $nuxt.$store.commit('setCartTitle', '支付订单');\r\n    this.getList()\r\n  },\r\n  methods: {\r\n    getList(){\r\n      pay($nuxt.$route.query.id).then(response => {\r\n        if(response.state !== 1) {  // 订单发生改变时，直接跳转到结果页\r\n          if (response.state === 4) {\r\n            // $nuxt.$router.replace('/user/indent/list')\r\n            $nuxt.$router.replace({path: '/user/indent/detail', query:{id:$nuxt.$route.query.id}})\r\n          } else {\r\n            $nuxt.$router.replace('/money/success')\r\n          }\r\n\r\n        }\r\n        this.loading = false;\r\n        this.list = response\r\n      }).catch(error=>{\r\n        this.$message({\r\n          message: '请求参数有误',\r\n          type: 'error'\r\n        });\r\n\r\n      })\r\n    },\r\n    // 显示详情\r\n    showDetail(){\r\n      this.detail = !this.detail\r\n    },\r\n    // 支付\r\n    payment(type){\r\n      this.buttonLoading = true\r\n      if(type === 1){ // 余额支付\r\n        balancePay({id:$nuxt.$route.query.id}).then(response => {\r\n          this.buttonLoading = false\r\n          $nuxt.$router.replace('/money/success')\r\n        })\r\n      }else{\r\n        unifiedPayment({\r\n          id: $nuxt.$route.query.id,\r\n          platform: type,\r\n          trade_type: 'NATIVE',\r\n          type: 'goodsIndent'\r\n        }).then(response => {\r\n          this.centerDialogVisible = true\r\n          this.qrcode = response.code_url\r\n          this.buttonLoading = false\r\n          if (this.timer) {\r\n            clearInterval(this.timer)\r\n            this.timer = setInterval(() => {\r\n              this.getList()\r\n            }, 5000);\r\n          } else {\r\n            this.timer = setInterval(() => {\r\n              this.getList()\r\n            }, 5000);\r\n          }\r\n        }).catch(error=>{\r\n          this.$message({\r\n            message: '支付配置有误，请检查',\r\n            type: 'error'\r\n          });\r\n        })\r\n      }\r\n    }\r\n  },\r\n  destroyed(){\r\n    clearInterval(this.timer)\r\n  }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;;;;;;;;;;ACjBA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AASA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AA9DA;AACA;AA8DA;AACA;AACA;AACA;AA1FA;;;;A","sourceRoot":""}