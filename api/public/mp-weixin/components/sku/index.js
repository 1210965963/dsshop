(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/sku/index"],{"0fa0":function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){}));var s=function(){var t=this.$createElement,e=(this._self._c,this.getLists.price_show&&this.specificationDefaultDisplay.price_show?this.specificationDefaultDisplay.price_show.length:null),i=!this.getLists.price_show||!this.specificationDefaultDisplay.price_show||e>1?null:this.specificationDefaultDisplay.price_show.length;this.$mp.data=Object.assign({},{$root:{g0:e,g1:i}})},o=[]},1760:function(t,e,i){"use strict";i.r(e);var s=i("8aa1"),o=i.n(s);for(var n in s)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return s[t]}))}(n);e["default"]=o.a},"3e46":function(t,e,i){"use strict";i.r(e);var s=i("0fa0"),o=i("1760");for(var n in o)["default"].indexOf(n)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(n);i("5c48");var r=i("f0c5"),c=Object(r["a"])(o["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);e["default"]=c.exports},"5c48":function(t,e,i){"use strict";var s=i("b1c1"),o=i.n(s);o.a},"8aa1":function(t,e,i){"use strict";(function(t){var s=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=s(i("448a")),n=s(i("9523")),r=i("2f14"),c=s(i("f2c2")),a=i("26cb");function u(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}var d={name:"sku",components:{uniNumberBox:function(){i.e("components/uni-number-box").then(function(){return resolve(i("e991"))}.bind(null,i)).catch(i.oe)}},props:{getList:{type:Object,default:function(){return{}}},cartDetails:{type:Object,default:function(){return{}}},update:{type:Boolean,default:!1},order:{type:Boolean,default:!1},buy:{type:Boolean,default:!1}},data:function(){return{cartGood:{number:1,price:""},specSelected:[],SKUResult:{},good_sku:{},selectedSku:[],selectedSkuIndex:[[]],specSelectedIndex:[],productSkus:[],selectedName:[],noSelectedName:[],specificationDefaultDisplay:{},specification:[],shoppingAttributes:[],getLists:this.getList,buyState:this.buy,loaded:!1}},watch:{getList:function(t){this.$emit("getList",t),this.getLists=this.getList,this.update||this.loaded||this.loadData()},buy:function(t){this.buyState=t},getLists:function(t){this.$emit("getLists",t)},cartDetails:function(t){this.getLists=t.good,this.initSelectSpec(t)}},computed:function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?u(Object(i),!0).forEach((function(e){(0,n.default)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):u(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},(0,a.mapState)(["hasLogin"])),methods:{loadData:function(){var t=this;if(this.loaded=!0,this.selectedSku=[],this.getLists.good_sku.length>0){var e=(0,r.param2Data)(this.getLists.good_sku),i=e.productSkus,s=e.specification;this.specification=s,s.forEach((function(e,i){t.specSelectedIndex.push(null),t.noSelectedName.push(e.value),e.leaf.forEach((function(e,s){t.selectedSku.push(e.id),t.selectedSkuIndex[e.id]={index:i,leaf:s}}))})),this.productSkus=i,i.forEach((function(e,i){e.data.forEach((function(e){e.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),t.SKUResult[e.join("_")]=!0}))})),this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show,selected:"选择 "+this.noSelectedName},this.$emit("purchasePattern","选择 "+this.noSelectedName)}else this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show},this.cartGood.price=this.getLists.price;if("undefined"!=typeof this.specification[0].leaf[0])for(var o=0;o<this.specification.length;o++)this.selectSpec(o,0,this.specification[o].leaf[0])},initSelectSpec:function(t){var e=this;this.selectedSku=[],this.SKUResult=[],this.cartGood.price=t.price,this.cartGood.number=t.number,this.shoppingAttributes=t.good_sku,this.good_sku=t.good_sku;var i=[],s=[];if(t.good_sku){var o=(0,r.param2Data)(this.getLists.good_sku),n=o.productSkus,c=o.specification;this.specification=c,c.forEach((function(o,n){o.leaf.forEach((function(r,a){for(var u=0;u<t.good_sku.product_sku.length;u++)if(r.value===t.good_sku.product_sku[u].value){o.leaf[a].selected=!0,e.specSelectedIndex[n]=a,null!==a&&(i.push(c[n]["leaf"][a]["id"]),s.push(n));break}e.selectedSku.push(r.id),e.selectedSkuIndex[r.id]={index:n,leaf:a}}))})),this.productSkus=n,n.forEach((function(t,i){t.data.forEach((function(t){t.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),e.SKUResult[t.join("_")]=!0}))}))}this.specificationDefaultDisplay={img:t.img,price_show:[t.good_sku.price],inventory_show:t.good_sku.inventory,selected:"已选 "+t.specification};var a=JSON.parse(JSON.stringify(this.selectedSku)),u=[];a.forEach((function(t){u=JSON.parse(JSON.stringify(i)),u.push(t),s.forEach((function(s,o){e.specification[s].leaf.forEach((function(e){e.id===t&&u.splice(u.indexOf(i[o]),1)}))})),u.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),e.SKUResult[u.join("_")]?e.specification[e.selectedSkuIndex[t].index].leaf[e.selectedSkuIndex[t].leaf].disabled=!1:e.specification[e.selectedSkuIndex[t].index].leaf[e.selectedSkuIndex[t].leaf].disabled=!0}))},priceInput:function(t){this.cartGood.price=parseFloat(t.target.value)},selectSpec:function(t,e,i){var s=this;if(i.disabled)return!1;var o=!1,n=this.specification;this.specSelectedIndex[t]===e?(this.$set(n[t]["leaf"][e],"selected",!n[t]["leaf"][e]["selected"]),this.specSelectedIndex[t]=null,this.noSelectedName.splice(t,0,n[t].value)):(null!==this.specSelectedIndex[t]&&this.$set(n[t]["leaf"][this.specSelectedIndex[t]],"selected",!1),this.$set(n[t]["leaf"][e],"selected",!n[t]["leaf"][e]["selected"]),this.specSelectedIndex[t]=e,this.noSelectedName.forEach((function(e,i){e===n[t].value&&s.noSelectedName.splice(i,1)}))),this.noSelectedName.length>0&&(this.specificationDefaultDisplay={img:this.getLists.resources_many[0].img,price_show:this.getLists.price_show,inventory_show:this.getLists.inventory_show,selected:"选择 "+this.noSelectedName},this.update||this.$emit("purchasePattern","选择 "+this.noSelectedName)),this.specSelected=[];var r="",c=[],a=[],u=JSON.parse(JSON.stringify(this.selectedSku));this.specSelectedIndex.forEach((function(t,e){null!==t?(s.specSelected.push(n[e]["leaf"][t]),r+=n[e]["id"]+"-"+n[e]["leaf"][t]["id"]+"_",c.push(n[e]["leaf"][t]["id"]),u.splice(u.indexOf(n[e]["leaf"][t]["id"]),1),a.push(e),o=!0):o=!1}));var d=[];if(u.forEach((function(t){d=JSON.parse(JSON.stringify(c)),d.push(t),a.forEach((function(e,i){s.specification[e].leaf.forEach((function(e){e.id===t&&d.splice(d.indexOf(c[i]),1)}))})),d.sort((function(t,e){return parseInt(t.replace("sku",""))-parseInt(e.replace("sku",""))})),s.SKUResult[d.join("_")]?n[s.selectedSkuIndex[t].index].leaf[s.selectedSkuIndex[t].leaf].disabled=!1:n[s.selectedSkuIndex[t].index].leaf[s.selectedSkuIndex[t].leaf].disabled=!0})),!0===o){this.cartGood.number=1,this.shoppingAttributes=[];for(var h=0;h<this.productSkus.length;h++)if(this.productSkus[h].ids===r.substr(0,r.length-1)){var p=function(){s.specificationDefaultDisplay;var t=[];return s.productSkus[h].skus.forEach((function(e){t.push(e.v)})),s.specificationDefaultDisplay={img:s.productSkus[h].resources?s.productSkus[h].resources.img:s.getLists.resources_many[0].img,price_show:[s.productSkus[h].price],inventory_show:s.productSkus[h].inventory,selected:"已选 "+t.join(";"),cost_price:s.productSkus[h].cost_price},s.update||s.$emit("purchasePattern","已选 "+t.join(";")),s.cartGood.price=s.productSkus[h].price,s.shoppingAttributes=s.productSkus[h],"break"}();if("break"===p)break}}},numberChange:function(t){this.cartGood.number=t.number},cart:function(){if(!this.hasLogin)return this.$api.msg("请先登录"),setTimeout((function(){t.navigateTo({url:"/pages/public/login"})}),1e3),!1;if(this.shoppingAttributes.id>0||0===this.getLists.good_sku.length){if(!/^\d+\.?\d{0,2}$/.test(this.cartGood.price))return t.showToast({icon:"none",title:"输入的金额有误",duration:2e3}),!1;if(this.$emit("toggleSpec"),this.order){if(this.getLists.good_sku.length>0){var e=this.getLists.resources_many[0].img;this.shoppingAttributes.resources&&(e=this.shoppingAttributes.resources.img);var i={id:this.cartDetails.id?this.cartDetails.id:0,name:this.getLists.name,price:this.cartGood.price,number:this.cartGood.number,good_sku_id:this.shoppingAttributes.id,good_id:this.getLists.id,good:this.getLists,good_sku:this.shoppingAttributes,img:e};this.$emit("setOrder",i)}}else{var s=t.getStorageSync("dsshopCartList")||[],n=new Map;this.buyState&&(s=[]),s.forEach((function(t){n.set(t.good_sku_id,t)}));var r=this.getLists.resources_many[0].img;if(this.getLists.good_sku.length>0)if(this.shoppingAttributes.resources&&(r=this.shoppingAttributes.resources.img),this.update&&this.good_sku.id!==this.shoppingAttributes.id&&n.delete(this.good_sku.id),n.get(this.shoppingAttributes.id)){this.update?n.get(this.shoppingAttributes.id).number=this.cartGood.number:n.get(this.shoppingAttributes.id).number+=this.cartGood.number,n.get(this.shoppingAttributes.id).number>this.specificationDefaultDisplay.inventory_show&&(n.get(this.shoppingAttributes.id).number=this.specificationDefaultDisplay.inventory_show),n.get(this.shoppingAttributes.id).price=this.cartGood.price,n.get(this.shoppingAttributes.id).name=this.getLists.name,n.get(this.shoppingAttributes.id).good_id=this.getLists.id;var a=JSON.parse(JSON.stringify(this.getLists));delete a.details,n.get(this.shoppingAttributes.id).good=a,n.get(this.shoppingAttributes.id).good_sku_id=this.shoppingAttributes.id,n.get(this.shoppingAttributes.id).good_sku=this.shoppingAttributes,n.get(this.shoppingAttributes.id).img=r}else n.set(this.shoppingAttributes.id,{price:this.cartGood.price,number:this.cartGood.number,name:this.getLists.name,good_id:this.getLists.id,good:this.getLists,good_sku_id:this.shoppingAttributes.id,good_sku:this.shoppingAttributes,img:r});else s["good_"+this.getLists.id]?(this.update?s["good_"+this.getLists.id].number=this.cartGood.number:s["good_"+this.getLists.id].number+=this.cartGood.number,s["good_"+this.getLists.id].number>this.getLists.inventory_show&&(s["good_"+this.getLists.id].number=this.getLists.inventory_show),s["good_"+this.getLists.id].price=this.cartGood.price,s["good_"+this.getLists.id].name=this.getLists.name,s["good_"+this.getLists.id].good_id=this.getLists.id,s["good_"+this.getLists.id].good=this.getLists,s["good_"+this.getLists.id].img=r):s["good_"+this.getLists.id]={price:this.cartGood.price,number:this.cartGood.number,name:this.getLists.name,good_id:this.getLists.id,good:this.getLists,img:r};if(this.buyState)t.setStorageSync("dsshopOrderList",(0,o.default)(n.values()));else{var u=this;c.default.addShoppingCart((0,o.default)(n.values()),(function(t){u.$emit("loadCart")})),t.setStorageSync("dsshopCartList",(0,o.default)(n.values()))}}this.initList(),this.update||(this.buyState?t.navigateTo({url:"/pages/indent/create"}):t.showToast({title:"成功加入购物车",duration:2e3}))}else t.showToast({icon:"none",title:"请选择规格",duration:2e3})},initList:function(){this.cartGood={number:1,price:""},this.specification=[],this.specificationDefaultDisplay=[],this.SKUResult=[],this.specSelected=[],this.specSelectedIndex=[],this.selectedName=[],this.noSelectedName=[],this.selectedSku=[],this.selectedSkuIndex=[[]],this.productSkus=[],this.shoppingAttributes=[],this.loadData()},previewImage:function(e){var i=[];i.push(e),t.previewImage({current:0,urls:i})}}};e.default=d}).call(this,i("543d")["default"])},b1c1:function(t,e,i){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/sku/index-create-component',
    {
        'components/sku/index-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("3e46"))
        })
    },
    [['components/sku/index-create-component']]
]);
