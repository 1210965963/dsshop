(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4d2149d3"],{"1e3c":function(t,e,n){},2680:function(t,e,n){"use strict";n("1e3c")},"2f1e":function(t,e,n){"use strict";n("e662")},6185:function(t,e,n){},"6bb7":function(t,e,n){"use strict";n("b5ba")},"95fb":function(t,e,n){"use strict";n("f4d3")},b5ba:function(t,e,n){},c90e:function(t,e,n){"use strict";n("6185")},ded5:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"build"},[n("control")],1)},i=[],s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"control"},[n("control-widgets"),n("control-panel"),n("control-config")],1)},c=[],a=n("5530"),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"wrap"},[n("div",{staticClass:"w-100 h-100 p16 bg-white"},[n("ul",{staticClass:"flex flex-wrap"},t._l(t.$initializing,(function(e,o){return n("li",{key:o,staticClass:"item",attrs:{"data-component":e.component,draggable:""},on:{dragstart:t.handleDragStart,dragend:t.dragEnd}},[n("i",{staticClass:"icon",class:e.icon}),n("span",[t._v(t._s(e.name))])])})),0)])])},l=[],u={inject:["control"],methods:{handleDragStart:function(t){this.control.dragWidget=this.$getNewComponent(t.target.dataset.component),this.control.dragstatus=!0},dragEnd:function(t){this.control.h5Iframe.contentWindow.postMessage({even:"drop",params:this.control.dragWidget},"*"),this.control.dragstatus=!1}}},g=u,d=(n("c90e"),n("2877")),f=Object(d["a"])(g,r,l,!1,null,"497ef618",null),p=f.exports,h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"panel"},[n("phone-ctn",[n("div",{staticClass:"page"},[t.initIframe?n("iframe",{ref:"iframe",staticClass:"page-iframe",style:{height:t.iframeHeight+"px",pointerEvents:t.control.dragstatus?"none":"auto"},attrs:{frameborder:"no",src:t.iframeUrl},on:{load:t.init}}):t._e(),n("div",{staticClass:"page-layer",style:{height:t.iframeHeight+"px",zIndex:t.control.dragstatus?"20":"1"},attrs:{type:"page"},on:{dragover:t.layerMove}},t._l(t.widgetInfoList,(function(e){return n("control-widget-shape",{key:e.id,attrs:{data:e},on:{changeCurrWidget:t.changeCurrWidget}},[n("div",{ref:"layerWidget",refInFor:!0,staticClass:"page-layer-widget",style:{height:e.height+"px"},attrs:{type:"widget",id:e.id}})])})),1)]),n("el-tooltip",{attrs:{effect:"light",content:"页面设置",placement:"bottom"}},[n("div",{staticClass:"panel-set flex-center",on:{click:function(e){t.control.curWidget=void 0}}},[n("i",{staticClass:"el-icon-setting"})])])],1)],1)},m=[],b=(n("b0c0"),n("7db0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"shape"},["waiting"!=t.data.component?n("div",{staticClass:"shape-tab",on:{click:function(e){return t.setcurComponent(t.data)}}},[t.control.curWidget&&t.control.curWidget.id==t.data.id?[n("i",{staticClass:"icon icon-shanchu tab-icon f16",on:{click:function(e){return e.stopPropagation(),t.delComponent(t.data.id)}}})]:n("span",[t._v(t._s(t.data.name))])],2):t._e(),t._t("default")],2)}),v=[],C=(n("c740"),n("a434"),{name:"shape",inject:["control"],props:{data:{type:Object}},methods:{setcurComponent:function(){this.$emit("changeCurrWidget",this.data)},delComponent:function(t){var e=this.control.curPage.componentList.findIndex((function(e){return e.id==t}));this.control.curPage.componentList.splice(e,1),this.control.curWidget=void 0}}}),w=C,W=(n("6bb7"),Object(d["a"])(w,b,v,!1,null,"be62b630",null)),j=W.exports,_=n("cdd9"),y=n("2f62"),L={components:{ControlWidgetShape:j},inject:["control"],created:function(){console.log("创建页面"),this.initIframe=!0},mounted:function(){this.control.h5Iframe=this.$refs.iframe,this.getMessage()},destroyed:function(){console.log("注销页面"),this.initIframe=!1,window.removeEventListener("message",this.getMessageHandle)},data:function(){return{widgetInfoList:[],iframeHeight:667,initIframe:!1}},computed:Object(a["a"])(Object(a["a"])({},Object(y["b"])(["project"])),{},{iframeUrl:function(){return"".concat(_["a"].viewUrl,"pages/build/build?operate=build")}}),watch:{"control.curPage.componentList":{handler:function(){this.messageList()},deep:!0}},methods:{init:function(){console.log("初始化..."),this.messageInit(),this.messageList()},getMessage:function(){window.addEventListener("message",this.getMessageHandle)},getMessageHandle:function(t){var e=this,n=t.data,o=n.type,i=n.params;switch(o){case"setList":e.setList(i);break;case"setHeight":e.setHeight(i);break;case"setCurrWidget":e.setCurrWidget(i);break}},setHeight:function(t){this.widgetInfoList=t,this.iframeHeight=this.widgetInfoList.reduce((function(t,e){return t+e.height}),0)},setList:function(t){console.log(" iframe内物料列表发生变化，同步更新"),console.log(t),console.log(this.control.curPage.name);var e=t.list;this.control.curPage.componentList=e,console.log(this.project)},setCurrWidget:function(t){var e=t.id;this.control.curWidget=this.control.curPage.componentList.find((function(t){return e==t.id}))},changeCurrWidget:function(t){this.setCurrWidget(t),this.$refs.iframe.contentWindow.postMessage({even:"changeCurrWidget",params:{id:t.id}},"*")},layerMove:function(t,e){this.throttle(this.layerMoveFun,1)(t,e)},layerMoveFun:function(t){if(t.preventDefault(),t.stopPropagation(),console.log("物料拖拽移动,控制waiting移动"),this.control.dragstatus){var e=t.target.getAttribute("type"),n={type:"page"};if("widget"==e){var o=[t.offsetY,t.target.offsetHeight],i=o[0],s=o[1];n={id:t.target.getAttribute("id"),type:"widget",direction:i<s/2}}this.$refs.iframe.contentWindow.postMessage({even:"move",params:n},"*")}},messageInit:function(){this.$refs.iframe.contentWindow.postMessage({even:"init",params:{project:this.project}},"*")},messageList:function(){console.log("发送信息，同步iframe种物料数组"),console.log(this.control.curPage),console.log(this.control.curPage.componentList),this.$refs.iframe.contentWindow.postMessage({even:"list",params:this.control.curPage.componentList},"*")},throttle:function(t,e){var n;return function(){var o=this,i=arguments;n||(n=setTimeout((function(){n=null,t.apply(o,i)}),e))}}}},$=L,k=(n("2680"),Object(d["a"])($,h,m,!1,null,"73027094",null)),x=k.exports,I=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"Config"},[t.control.curWidget?n("config-ctn",{attrs:{title:t.control.curWidget.name}},[n("custom-schema-template",{attrs:{schema:t.curSchema},model:{value:t.control.curWidget,callback:function(e){t.$set(t.control,"curWidget",e)},expression:"control.curWidget"}})],1):n("config-ctn",{attrs:{title:"页面配置"}},[n("page-config")],1)],1)},O=[],P=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"p10"},[n("config-item",{attrs:{label:"背景色"}},[n("config-color-picker",{model:{value:t.project.config.backgroundColor,callback:function(e){t.$set(t.project.config,"backgroundColor",e)},expression:"project.config.backgroundColor"}})],1)],1)},M=[],E={name:"PageConfig",computed:Object(a["a"])({},Object(y["b"])(["project"]))},H=E,S=Object(d["a"])(H,P,M,!1,null,null,null),D=S.exports,F={components:{PageConfig:D},inject:["control"],computed:{curSchema:function(){return console.log("curSchema"),console.log(this.control.curWidget),this.$fields[this.control.curWidget.component]}}},U=F,z=Object(d["a"])(U,I,O,!1,null,null,null),A=z.exports,J={name:"control",components:{ControlWidgets:p,ControlPanel:x,ControlConfig:A},provide:function(){return{control:this}},data:function(){return{dragstatus:!1,curWidget:null,dragWidget:null}},computed:Object(a["a"])({},Object(y["b"])(["curPage"]))},N=J,T=(n("95fb"),Object(d["a"])(N,s,c,!1,null,null,null)),Y=T.exports,q={components:{Control:Y}},B=q,G=(n("2f1e"),Object(d["a"])(B,o,i,!1,null,"2fc464f9",null));e["default"]=G.exports},e662:function(t,e,n){},f4d3:function(t,e,n){}}]);
//# sourceMappingURL=chunk-4d2149d3.130848b3.js.map